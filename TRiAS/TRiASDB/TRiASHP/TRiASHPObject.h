// $Header: $
// Copyright© 1998-2000 TRiAS GmbH Potsdam, All rights reserved
// Created: 10.05.2000 19:36:40 
//
// This file was generated by the TRiASDB Data Server Wizard V1.02.086 (#HK000510)
//
// @doc
// @module TRiASHPObject.h | Declaration of the <c CTRiASHPObject> class

#if !defined(_TRIASHPOBJECT_H__904A8FEF_6F67_4525_AB7B_D6445B655E30__INCLUDED_)
#define _TRIASHPOBJECT_H__904A8FEF_6F67_4525_AB7B_D6445B655E30__INCLUDED_

#if _MSC_VER >= 1000
#pragma once
#endif // _MSC_VER >= 1000

// Header include diagnostics
#if defined(_TRIAS_DBG_HEADER_DIAGNOSTICS)
#pragma message(__TIME__": include " __FILE__ )
#endif

#include <Com/OleClientSiteNotImpl.h>

#include "resource.h"				 // main symbols

/////////////////////////////////////////////////////////////////////////////
// SmartIF's
DefineSmartInterface(TRiASObject);

/////////////////////////////////////////////////////////////////////////////
// CTRiASHPObject
class ATL_NO_VTABLE CTRiASHPObject : 
	public CComObjectRootEx<CComObjectThreadModel>,
	public CComCoClass<CTRiASHPObject, &CLSID_TRiASHPObject>,
	public CErrSupport<CTRiASHPObject, &IID_ITRiASObject>,
	public IOleClientSiteNotImpl,
	public ITRiASObjectCallback
{
public:
	CTRiASHPObject() 
	{
	}

	_ATLX_DEBUG_OBJECTCOUNT_IMPL(CTRiASHPObject)

	DECLARE_REGISTRY_RESOURCEID(IDR_TRIASHPOBJECT_RGS)
	DECLARE_AGGREGATE_EX_SUPPORT();

	BEGIN_COM_MAP(CTRiASHPObject)
		COM_INTERFACE_ENTRY(ITRiASObjectCallback)
		COM_INTERFACE_ENTRY(ISupportErrorInfo)
		COM_INTERFACE_ENTRY(IOleClientSite)
		COM_INTERFACE_ENTRY_THIS()
		
	// durch aggregiertes Objekt implementierte Interfaces
		COM_INTERFACE_ENTRY_AGGREGATE_EX(IID_ITRiASObject, m_BaseUnk.p)
		COM_INTERFACE_ENTRY_AGGREGATE_EX(IID_ITRiASBase, m_BaseUnk.p)
		COM_INTERFACE_ENTRY_AGGREGATE_EX(IID_IDispatch, m_BaseUnk.p)
		COM_INTERFACE_ENTRY_AGGREGATE_EX(IID_IConnectionPointContainer, m_BaseUnk.p)
		COM_INTERFACE_ENTRY_AGGREGATE_BLIND(m_BaseUnk.p)		// alles andere nicht gesondert behandeln
	END_COM_MAP()

	DECLARE_GET_CONTROLLING_UNKNOWN()
	DECLARE_PROTECT_FINAL_CONSTRUCT()
	HRESULT FinalConstruct()
	{
		RETURN_FAILED_HRESULT(m_BaseUnk.CreateInstance (CLSID_TRiASObject, CLSCTX_ALL, GetControllingUnknown()));

	WTRiASObject BaseObj;

		RETURN_FAILED_HRESULT(m_BaseUnk -> QueryInterface(BaseObj.ppi()));
		return BaseObj -> putref_ObjectCallback(this);
	}
	void FinalRelease (void)
	{
		m_BaseUnk.Assign(NULL);
	}

// ISupportsErrorInfo
	STDMETHOD(InterfaceSupportsErrorInfo)(REFIID riid);

// ITRiASObjectCallback
	STDMETHOD(get_DefaultType)(BSTR *pbstrType);
	STDMETHOD(SetupObject)(SETUPOBJECTMODE rgMode);
	STDMETHOD(SetupFeatures)(SETUPFEATURESMODE rgMode);
	STDMETHOD(OnDelete)();
	STDMETHOD(OnChanging)(CHANGEDOBJECT rgWhat, VARIANT vNewValue, VARIANT_BOOL *pDisAllow);
	STDMETHOD(OnChanged)(CHANGEDOBJECT rgWhat, VARIANT vOldValue);
	STDMETHOD(OnFinalRelease)();

// IOleClientSite
	STDMETHOD(GetMoniker)(DWORD dwAssign, DWORD dwWhichMoniker, IMoniker **ppmk);

protected:
	HRESULT GetContainerMoniker (IMoniker **ppIMk);
	HRESULT GetThisMoniker (DWORD dwWhich, IMoniker **ppIMk);

private:
	WUnknown m_BaseUnk;					// aggregiertes Objekt
};

#endif // !defined(_TRIASHPOBJECT_H__904A8FEF_6F67_4525_AB7B_D6445B655E30__INCLUDED_)
